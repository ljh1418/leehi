<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd"> 



<!-- 모든페이지 권한 ROLE_USER 

username-parameter 					: input 태그의 아이디 혹은 이메일 name 속성 값 (default: username)
password-parameter 					: input 태그의 비밀번호 name 속성 값 (default: password)
login-page 							: 새로운 로그인 화면 url (default: 스프링 기본 로그인 화면)
login-processing-url 				: form 태그의 action 속성 (default: POST /login)
default-target-url 					: 로그인 성공시 호출할 url
authentication-failure-url 			: 로그인 실패시 호출할 url (default: /login?error=1)
authentication-success-handler-ref 	: 로그인 성공시 default-target-url이 아닌 핸들러로 리다이렉트
authentication-failure-handler-ref 	: 로그인 실패시 authentication-failure-url이 아닌 핸들러로 리다이렉트
always-use-default-target 			: 무조건 핸들러가 지정한 페이지로 이동 (default: false)
-->



<!-- xmlns:context="http://www.springframework.org/schema/context" -->
<!-- http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd -->
<!-- 추가 혹은 namepsace 에서 context 체크박스 선택 -->
<!-- security 설정파일에서 SqlSessionTemplate 부분을 찾아야 해서 component 설정 -->
<!-- <context:component-scan base-package="lee.jun.ho.user.dao" /> -->

<http auto-config="true" use-expressions="true">

	<!-- 인터셉터 페이지 가로체가는 역활 -->
	<intercept-url pattern="/member/**" access="hasAnyRole('ROLE_MEMBER','ROLE_ADMIN')"/>
	<intercept-url pattern="/user/**" access="hasAnyRole('ROLE_USER','ROLE_MEMBER','ROLE_ADMIN')"/>
	<intercept-url pattern="/admin/**" access="hasRole('ROLE_ADMIN')"/>
	<intercept-url pattern="/**" access="permitAll"/>
	
	<!-- 스프링 시큐리티 로그인페이지 커스터마이징 -->	    
    <form-login
    	username-parameter="loginId"
    	password-parameter="loginPwd"
    	login-processing-url="/login"
    	login-page="/secu/loginPage"
    	default-target-url="/"
    />
    
    <!-- 접근불가 페이지 커스터마이징 -->
    <access-denied-handler
		error-page="/access_denied_page"
	/>
	

	
	<!--  
	로그아웃관련
	logout-url			: 로그아웃 처리에 대한 URL. form태그의 action 속성에 지정한 값. (default: POST /logout)
	logout-success-url 	: 로그아웃 성공시, 이동할 URL. (default: /login?logout)
	invalidate-session 	: 로그아웃 시, session을 무효화할 지 선택. (default: true)
	delete-cookies 		: 로그아웃 성공시, 삭제할 쿠키 이름 지정
	success-handler-ref : 로그아웃 성공시, logout-success-url 이 아닌 핸들러로 리다이렉트 
	-->
	
	<logout
    	logout-url="/logout"
    	invalidate-session="true"
    	logout-success-url="/"
    />
	

    
</http>

<!-- 테스트용 유저 id , pw , 권한 -->        
<!-- <authentication-manager>
    <authentication-provider>
        <user-service>
            <user name="user" password="user" authorities="ROLE_USER"/>
            <user name="member" password="member" authorities="ROLE_MEMBER"/>
            <user name="admin" password="admin" authorities="ROLE_ADMIN"/>
        </user-service>
    </authentication-provider>
</authentication-manager> -->

<!-- DB데이터 유저정보 -->
<!-- 사용자 인증컬럼 ENABLED가 없으면 에러 나오는 현상 있음 -->     
<jdbc-user-service data-source-ref="dataSource" id="userService"
			users-by-username-query="SELECT ID as loginId, PASSWORD as loginPwd, ENABLED FROM USERTEST WHERE ID=?"
			authorities-by-username-query="SELECT ID as loginID, AUTHORITY FROM USERTEST WHERE ID=?"
		/>
        
        <authentication-manager>
	        <!-- 유저 정보를 가져오는 클래스를 설정하는 곳이다. userService는  아래의 bean id의 클래스를 뜻한다 -->
            <authentication-provider user-service-ref="userService">
            </authentication-provider>
        </authentication-manager>
		
		<!-- UserDetailsService 인터페이스를 구현해서 만든 클래스를 userService라는 이름으로 bean 등록한다. -->
		<beans:bean id="userService" class="lee.jun.ho.user.service.CustomUserDetailsService"/>


  
  
</beans:beans>

